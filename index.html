<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Normi Mega Shop</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <style>
        :root {
            --tg-blue: #0088cc;
            --bg: #f5f5f7;
            --card: #ffffff;
            --text: #000000;
            --sub: #8e8e93;
        }
        body.dark {
            --bg: #1c1c1d;
            --card: #2c2c2e;
            --text: #ffffff;
            --sub: #aaaaaa;
        }
        body { font-family: -apple-system, system-ui; background: var(--bg); color: var(--text); margin: 0; transition: 0.3s; overflow-x: hidden; }
        
        .screen { display: none; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .screen.active { display: block; }

        /* Auth Card */
        .card { background: var(--card); border-radius: 20px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; background: var(--card); color: var(--text); }
        
        .btn { background: var(--tg-blue); color: #white; border: none; padding: 14px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin: 5px 0; color: white; }
        .btn-outline { background: none; border: 2px solid var(--tg-blue); color: var(--tg-blue); }
        
        /* TabBar */
        .tab-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card); display: flex; border-top: 1px solid #ddd; padding: 10px 0; z-index: 100; }
        .tab { flex: 1; text-align: center; font-size: 11px; color: var(--sub); cursor: pointer; }
        .tab.active { color: var(--tg-blue); }
        .tab-icon { font-size: 20px; display: block; }

        /* Shop Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .item { background: var(--card); border-radius: 15px; padding: 10px; text-align: center; }
        
        /* Modal Settings */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: var(--card); width: 80%; border-radius: 20px; padding: 20px; }
    </style>
</head>
<body>

<div id="screen-auth" class="screen active">
    <div class="card" style="text-align: center; margin-top: 40px;">
        <h2 data-i18n="welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h2>
        <input type="email" id="auth-email" placeholder="Email">
        <input type="password" id="auth-pass" placeholder="Password">
        
        <p data-i18n="how_verify">–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ—á—Ç—É?</p>
        <div style="display:flex; gap:10px;">
            <button class="btn" onclick="startAuth('code')" data-i18n="via_code">üî¢ –ö–æ–¥–æ–º</button>
            <button class="btn btn-outline" onclick="startAuth('link')" data-i18n="via_link">üîó –°—Å—ã–ª–∫–æ–π</button>
        </div>
        
        <div id="code-input-area" style="display:none; margin-top: 20px;">
            <input type="number" id="ver-code-val" placeholder="000000">
            <button class="btn" onclick="finishCodeAuth()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
        </div>
        
        <button class="btn" style="background:#db4437; margin-top:20px;" onclick="loginGoogle()">Google Login</button>
    </div>
</div>

<div id="screen-main" class="screen">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <h1 id="screen-title" data-i18n="shop">–ú–∞–≥–∞–∑–∏–Ω</h1>
        <button onclick="toggleModal(true)" style="background:none; border:none; font-size:24px;">‚öôÔ∏è</button>
    </div>

    <div id="tab-shop" class="tab-content">
        <div class="grid">
            <div class="item"><h3>Tetris VIP</h3><p>99 ‚ÇΩ</p><button class="btn">Buy</button></div>
            <div class="item"><h3>Snake Pro</h3><p>49 ‚ÇΩ</p><button class="btn">Buy</button></div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content" style="display:none;">
        <div class="card">
            <h3 id="user-name">User</h3>
            <p>ID: <span id="user-id">...</span></p>
            <button class="btn btn-outline" onclick="changeNick()" data-i18n="change_nick">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
        </div>
        <button class="btn" style="background:#ff3b30" onclick="firebase.auth().signOut()" data-i18n="logout">–í—ã–π—Ç–∏</button>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="switchTab('shop', this)"><span class="tab-icon">üõí</span><span data-i18n="shop">–ú–∞–≥–∞–∑–∏–Ω</span></div>
        <div class="tab" onclick="switchTab('games', this)"><span class="tab-icon">üéÆ</span><span data-i18n="games">–ò–≥—Ä—ã</span></div>
        <div class="tab" onclick="switchTab('chats', this)"><span class="tab-icon">üí¨</span><span data-i18n="chat">–ß–∞—Ç—ã</span></div>
        <div class="tab" onclick="switchTab('profile', this)"><span class="tab-icon">üë§</span><span data-i18n="profile">–ü—Ä–æ—Ñ–∏–ª—å</span></div>
    </div>
</div>

<div id="modal-settings" class="modal">
    <div class="modal-content">
        <h3 data-i18n="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <label>–Ø–∑—ã–∫ / Language:</label>
        <select id="lang-select" onchange="setLang(this.value)" style="width:100%; padding:10px; border-radius:10px; margin:10px 0;">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
            <option value="es">Espa√±ol</option>
            <option value="zh">‰∏≠Êñá</option>
            <option value="ja">Êó•Êú¨Ë™û</option>
            <option value="ko">ÌïúÍµ≠Ïñ¥</option>
            <option value="meme">–ú–µ–º–Ω—ã–π (RU)</option>
        </select>
        
        <button class="btn btn-outline" onclick="toggleTheme()" style="margin-top:10px;">üåì –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
        <button class="btn" onclick="toggleModal(false)" style="margin-top:20px;">–û–ö</button>
    </div>
</div>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–í–°–¢–ê–í–¨ –°–í–û–Å) ---
const firebaseConfig = {
    apiKey: "AIzaSyBALmJCUM8bIdVgBFJF66N_VoOcU4V1nqs",
    authDomain: "normishop.firebaseapp.com",
    projectId: "normishop",
    storageBucket: "normishop.firebasestorage.app",
    messagingSenderId: "688066350050",
    appId: "1:688066350050:web:ceba21916cf9708a84c7bb"
};
firebase.initializeApp(firebaseConfig);
emailjs.init("–¢–í–û–ô_PUBLIC_KEY"); // <-- –¢–í–û–ô –ö–õ–Æ–ß –¢–£–¢

const auth = firebase.auth();
const db = firebase.firestore();
let generatedCode = null;

// --- –ü–ï–†–ï–í–û–î–´ ---
const translations = {
    ru: { welcome: "–ü—Ä–∏–≤–µ—Ç!", shop: "–ú–∞–≥–∞–∑–∏–Ω", games: "–ò–≥—Ä—ã", chat: "–ß–∞—Ç—ã", profile: "–ü—Ä–æ—Ñ–∏–ª—å", settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", via_code: "–ö–æ–¥–æ–º", via_link: "–°—Å—ã–ª–∫–æ–π", logout: "–í—ã–π—Ç–∏", change_nick: "–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫", how_verify: "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏–º –ø–æ—á—Ç—É?" },
    en: { welcome: "Welcome!", shop: "Shop", games: "Games", chat: "Chats", profile: "Profile", settings: "Settings", via_code: "Code", via_link: "Link", logout: "Logout", change_nick: "Change Nick", how_verify: "Verify method?" },
    meme: { welcome: "–ó–¥–∞—Ä–æ–≤–∞, –ª–µ–≥–µ–Ω–¥–∞!", shop: "–ë–∞–∑–∞—Ä", games: "–ö–∞—Ç–∫–∏", chat: "–¢—ë—Ä–∫–∏", profile: "–ú–æ—è —Ä–µ–ø–∞", settings: "–®–µ—Å—Ç–µ—Ä–Ω–∏", via_code: "–¶–∏—Ñ—Ä–∞–º–∏", via_link: "–¢—ã–∫–æ–º", logout: "–õ–∏–≤–Ω—É—Ç—å", change_nick: "–ù–æ–≤–æ–µ –ø–æ–≥–æ–Ω—è–ª–æ", how_verify: "–ö–∞–∫ —á–µ–∫–∞—Ç—å –±—É–¥–µ–º?" },
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —è–∑—ã–∫–∏ –¥–æ–±–∞–≤—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ (es, zh, ja, ko)
};

// --- –õ–û–ì–ò–ö–ê ---
function setLang(l) {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.innerText = translations[l][key] || translations['en'][key];
    });
}

function toggleTheme() {
    document.body.classList.toggle('dark');
}

function toggleModal(show) {
    document.getElementById('modal-settings').style.display = show ? 'flex' : 'none';
}

function switchTab(tabId, el) {
    document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById('tab-' + tabId).style.display = 'block';
    el.classList.add('active');
    document.getElementById('screen-title').innerText = translations['ru'][tabId] || tabId;
}

// --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
async function startAuth(method) {
    const email = document.getElementById('auth-email').value;
    const pass = document.getElementById('auth-pass').value;
    if(!email || !pass) return alert("–í–≤–µ–¥–∏ –¥–∞–Ω–Ω—ã–µ!");

    if(method === 'link') {
        auth.createUserWithEmailAndPassword(email, pass).then(res => {
            res.user.sendEmailVerification();
            alert("–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—á—Ç–µ!");
        }).catch(e => alert(e.message));
    } else {
        generatedCode = Math.floor(100000 + Math.random() * 900000);
        emailjs.send("service_z8qzjdb", "template_abc", { to_email: email, ver_code: generatedCode })
        .then(() => {
            document.getElementById('code-input-area').style.display = 'block';
            alert("–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
        });
    }
}

async function finishCodeAuth() {
    const input = document.getElementById('ver-code-val').value;
    if(input == generatedCode) {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        auth.createUserWithEmailAndPassword(email, pass).catch(e => auth.signInWithEmailAndPassword(email, pass));
    } else alert("–ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π!");
}

function loginGoogle() {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}

auth.onAuthStateChanged(user => {
    if(user) {
        document.getElementById('screen-auth').classList.remove('active');
        document.getElementById('screen-main').classList.add('active');
        document.getElementById('user-id').innerText = user.uid;
        document.getElementById('user-name').innerText = user.displayName || "User";
    } else {
        document.getElementById('screen-auth').classList.add('active');
        document.getElementById('screen-main').classList.remove('active');
    }
});
</script>
</body>
</html>
