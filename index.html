<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Normi Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        :root { --tg-color: #0088cc; --bg-color: #f4f4f7; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg-color); margin: 0; padding: 15px; user-select: none; }
        
        /* –°—Ç–∏–ª—å –∫–æ—à–µ–ª—å–∫–∞ */
        .wallet-card { background: #fff; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .balance-label { color: #8e8e93; font-size: 14px; }
        .balance-value { font-size: 38px; font-weight: 800; margin: 10px 0; color: #000; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn { background: var(--tg-color); color: #fff; border: none; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-secondary { background: #e5e5ea; color: #000; }
        
        /* –°–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π */
        .menu-list { background: #fff; border-radius: 15px; margin-top: 20px; overflow: hidden; }
        .menu-item { padding: 15px; border-bottom: 1px solid #f2f2f7; display: flex; justify-content: space-between; cursor: pointer; }
        .menu-item:last-child { border-bottom: none; }

        /* –ê–¥–º–∏–Ω–∫–∞ */
        #admin-panel { display: none; background: #ffebeb; border: 2px dashed red; margin-top: 20px; border-radius: 15px; padding: 15px; }
    </style>
</head>
<body>

    <div class="wallet-card">
        <div class="balance-label">–ú–æ–π –±–∞–ª–∞–Ω—Å</div>
        <div class="balance-value" id="balance">0.00 ‚ÇΩ</div>
        <div class="btn-group">
            <button class="btn" onclick="requestDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            <button class="btn btn-secondary" onclick="alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–í—ã–≤–µ—Å—Ç–∏</button>
        </div>
    </div>

    <div class="menu-list">
        <div class="menu-item" onclick="alert('–ú–∞–≥–∞–∑–∏–Ω –ø—É—Å—Ç')"><span>üõí –ú–∞–≥–∞–∑–∏–Ω</span> ‚ùØ</div>
        <div class="menu-item" onclick="alert('–°–∫–æ—Ä–æ –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä!')"><span>üéÆ –ú–∏–Ω–∏-–∏–≥—Ä—ã</span> ‚ùØ</div>
        <div class="menu-item" onclick="alert('–ù–∞–ø–∏—à–∏—Ç–µ @—Ç–≤–æ–π_–Ω–∏–∫')"><span>üéß –ü–æ–¥–¥–µ—Ä–∂–∫–∞</span> ‚ùØ</div>
    </div>

    <div id="admin-panel">
        <h3 style="color:red; margin-top:0;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
        <input type="number" id="admin-amount" placeholder="–°—É–º–º–∞" style="width:70%; padding:8px; border-radius:8px; border:1px solid #ccc;">
        <button class="btn" style="width:auto; padding:8px 15px;" onclick="addBalanceManual()">–î–∞—Ç—å ‚ÇΩ</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–≤–æ–µ–≥–æ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBALmJCUM8bIdVgBFJF66N_VoOcU4V1nqs",
            authDomain: "normishop.firebaseapp.com",
            databaseURL: "https://normishop-default-rtdb.firebaseio.com",
            projectId: "normishop",
            storageBucket: "normishop.firebasestorage.app",
            messagingSenderId: "688066350050",
            appId: "1:688066350050:web:ceba21916cf9708a84c7bb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const userId = tg.initDataUnsafe.user?.id || "test_user"; // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¢–ì
        
        // –¢–í–û–ô ID (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –Ω–∞—Å—Ç–æ—è—â–∏–π ID –∏–∑ –¢–ì, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∞–¥–º–∏–Ω–∫—É)
        const MY_ID = 12345678; 

        if (userId === MY_ID) {
            document.getElementById('admin-panel').style.display = 'block';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadData() {
            db.collection("users").doc(userId.toString()).onSnapshot((doc) => {
                if (doc.exists) {
                    document.getElementById('balance').innerText = doc.data().balance.toFixed(2) + ' ‚ÇΩ';
                } else {
                    // –°–æ–∑–¥–∞–µ–º —é–∑–µ—Ä–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                    db.collection("users").doc(userId.toString()).set({ balance: 0, role: "user" });
                }
            });
        }

        // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (–∑–∞—è–≤–∫–∞ –∞–¥–º–∏–Ω—É)
        function requestDeposit() {
            tg.showPopup({
                title: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞',
                message: '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–µ–Ω—å–≥–∏ –ø–æ –Ω–æ–º–µ—Ä—É +7900... –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω—É –≤–∞—à ID: ' + userId,
                buttons: [{text: '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID', type: 'default'}, {text: '–ó–∞–∫—Ä—ã—Ç—å', type: 'destructive'}]
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –∞–¥–º–∏–Ω–∞: –¥–æ–±–∞–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
        function addBalanceManual() {
            const amt = parseFloat(document.getElementById('admin-amount').value);
            if (!amt) return;
            db.collection("users").doc(userId.toString()).update({
                balance: firebase.firestore.FieldValue.increment(amt)
            });
        }

        loadData();
    </script>
</body>
</html>
